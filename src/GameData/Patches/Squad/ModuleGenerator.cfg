// ModuleGenerator is fairly simple. We just need to check the generatorIsActive
// field on the module in order to determine whether it is active.
//
// It only really seems to be used by RTGs and launch clamps (even in mods) so
// this setup here should be simple enough for pretty much all use cases.
//
// TODO: This ignores the efficiency field on the generator. It may be worth
//       building a specialized module to do exactly that.

@PART[*]:HAS[@MODULE[ModuleGenerator]]:LAST[BackgroundResourceProcessing]
{
    %brpModuleIndexCounter = 0
    @MODULE[ModuleGenerator],* {
        %brpModuleIndex = #$../brpModuleIndexCounter$
        *@../brpModuleIndexCounter += 1
    }

    +MODULE[ModuleGenerator]:HAS[~isThrottleControlled]
    {
        TargetModule = #$name$
        TargetIndex = #$brpModuleIndex$
        @name = ModuleBackgroundConditionalConverter

        Condition = generatorIsActive

        @RESOURCE {
            |_ = INPUT_RESOURCE
        }

        @INPUT_RESOURCE {
            Resource = #$name$
            Ratio    = #$rate$

            !name = delete
            !rate = delete
        }

        @OUTPUT_RESOURCE {
            Resource = #$name$
            Ratio    = #$rate$

            !name = delete
            !rate = delete
        }

        !isAlwaysActive = delete
        !isGroundFixture = delete
        !brpModuleIndex = delete
    }

    @MODULE[ModuleGenerator]
    {
        !brpModuleIndex = delete
    }

    !brpModuleIndexCounter = delete
}
